using Content.Shared.Administration.Logs;
using Robust.Client.AutoGenerated;
using Robust.Client.UserInterface.Controls;
using Robust.Client.UserInterface.XAML;
using Robust.Shared.Timing;

namespace Content.Client.Administration.UI.Logs;

[GenerateTypedNameReferences]
public sealed partial class AdminLogsEntry : BoxContainer
{
    [Dependency] private readonly IGameTiming _gameTiming = default!;
    public SharedAdminLog Log { get; }

    public AdminLogsEntry(ref SharedAdminLog log)
    {
        RobustXamlLoader.Load(this);

        Log = log;
        Message.SetMessage($"{log.Date:HH:mm:ss}: {log.Message}");

        // We perform some extra calculations in the dropdown,
        // so we want to avoid doing that for all log messages.
        DetailsHeading.OnToggled += DetailsToggled;
    }

    private void DetailsToggled(BaseButton.ButtonToggledEventArgs args)
    {
        if (args.Pressed && DetailsBody is { ChildCount: 0 } body)
            body.AddChild(new AdminLogsEntryDetails(Log));
    }
}
